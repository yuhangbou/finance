webpackJsonp([18],{jLGC:function(e,t){},mxnI:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("3cXf"),a=i.n(o),r=i("4YfN"),n=i.n(r),c=i("a3Yh"),l=i.n(c),s=i("IfhF"),u=i("7yAV"),p=i.n(u),m=i("ZZch"),d={name:"xianjinliuliangbiao",mixins:[s.a],inject:["reload","set_router"],data:function(){var e;return{show_huoban:!1,invoicePhoto1:"",list:[],form:{invoiceType:"",invoicingDate:"",authenticationDate:"",invoiceNumber:"",supplierType:"",supplierName:"",money:"",taxRate:"",priceTaxTotal:"",invoicePhoto:""},rules:(e={invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoicingDate:[{required:!0,message:"请选择开票日期",trigger:"change"}],invoiceNumber:[{required:!0,message:"请输入发票号码",trigger:"blur"}],supplierType:[{required:!0,message:"请选择供应商或客户",trigger:"change"}],supplierName:[{required:!0,message:"请选择",trigger:"change"}]},l()(e,"supplierType",[{required:!0,message:"请选择供应商或客户",trigger:"change"}]),l()(e,"money",[{required:!0,message:"请输入金额",trigger:"blur"}]),l()(e,"taxRate",[{required:!0,message:"请输入税率",trigger:"blur"}]),l()(e,"priceTaxTotal",[{required:!0,message:"请选择价税合计",trigger:"blur"}]),e)}},components:{addHuoBan:m.a},mounted:function(){var e=this;this.getStorage(),this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(t){e.list=t,e._ajax("userAccounts/selectUserInvoiceOne",{uuid:e.uuid,workAccountId:e.accountId,invoiceId:e.$route.query.invoiceId},function(t){e.form.invoiceType=t.company_invoice_type,e.form.invoicingDate=t.invoicing_date,e.form.authenticationDate=t.authentication_date,e.form.invoiceNumber=t.company_invoice_number,e.form.supplierType=t.company_supplier_type,e.form.supplierName=t.company_supplier_name,e.form.money=t.money,e.form.taxRate=t.tax_rate,e.form.priceTaxTotal=t.price_tax_total,e.form.invoicePhoto=t.invoice_photo})})},methods:{add_huoban_ok:function(e){var t=this;1==e?this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(e){t.list=e,t.show_huoban=!1}):this.show_huoban=!1},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t._ajax("userAccounts/updateUserInvoice",n()({uuid:t.uuid,workAccountId:t.accountId},t.form,{invoiceId:t.$route.query.invoiceId}),function(e){t._message(1,"修改成功"),t.$router.push({path:"/home/fapiao/fapiaoguanli"}),t.set_router("/home/fapiao/fapiaoguanli")})})},quxiao_liushui:function(){var e=this;this._ajax("userAccounts/deleteInvoiceFlowing",{uuid:this.uuid,workAccountId:this.accountId,invoiceId:this.$route.query.invoiceId,accountingId:this.form.company_accounting_id},function(t){e._message(1,"取消关联流水成功"),e.liushui=""})},quxiao_pingzheng:function(){var e=this;this._ajax("userAccounts/deleteInvoiceCrtificate",{uuid:this.uuid,workAccountId:this.accountId,invoiceId:this.$route.query.invoiceId,certificateUuid:this.form.company_certificate_uuid},function(t){e._message(1,"取消关联凭证成功"),e.pingzheng=""})},change:function(e){var t=this,i=this.$message({type:"warning",message:"发票识别中请稍后",duration:0});!function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)}(e.raw,function(e){t._ajax("common/invoice",{encode:a()(e.split(",")[1])},function(e){i.close(),t._message(1,"识别成功"),t.form={invoiceType:"",invoicingDate:"",authenticationDate:"",invoiceNumber:"",supplierType:"",supplierName:"",money:"",taxRate:"",priceTaxTotal:"",invoicePhoto:""},t.form.invoicePhoto=t.invoicePhoto1,t.form.invoicePhoto=t.invoicePhoto1,t.form.invoiceId=e.kind,t.form.invoiceNumber=e.number,t.form.priceTaxTotal=e.total,t.form.money=e.pretax_amount,t.form.taxRate=100*(e.tax/e.pretax_amount).toFixed(2)+"%";var o="";e.date.split("").forEach(function(t,i){"年"==t||"月"==t||"日"==t?i!=e.date.split("").length-1&&(o+="-"):o+=t}),t.form.invoicingDate=o})});var o=this;if(void 0==e)return!1;var r=e.name,n=r.substr(r.lastIndexOf(".")),c="user-herder"+Date.parse(new Date)/1e3+n;new p.a.Wrapper(this.$ali).multipartUpload(c,e.raw).then(function(e){o.invoicePhoto1=e.res.requestUrls[0].split("?")[0]}).catch(function(e){console.log(e),o.$message({message:"服务器繁忙，请稍后再试",type:"error"})})}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticStyle:{background:"#FFF",padding:"2vh 2vw"}},[i("div",{staticStyle:{"font-size":"30px",color:"#1C2023","text-align":"center"}},[e._v("编辑发票")]),e._v(" "),i("div",{staticStyle:{border:"1px solid #F8F8FF",padding:"2vh 2vw","margin-top":"2vh"}},[i("el-upload",{attrs:{"on-change":e.change,action:"","show-file-list":!1,"auto-upload":!1}},[i("el-button",{attrs:{type:"warning"}},[e._v("点击上传")])],1),e._v(" "),i("div",{staticStyle:{"border-bottom":"1px solid rgba(96,105,114,0.3)",margin:"3vh 0"}}),e._v(" "),i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[i("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},[i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票类型：",prop:"invoiceType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[i("el-option",{attrs:{label:"专票",value:"0"}}),e._v(" "),i("el-option",{attrs:{label:"普票",value:"1"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"开票日期：",prop:"invoicingDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.invoicingDate,callback:function(t){e.$set(e.form,"invoicingDate",t)},expression:"form.invoicingDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"认证日期："}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.authenticationDate,callback:function(t){e.$set(e.form,"authenticationDate",t)},expression:"form.authenticationDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票号码：",prop:"invoiceNumber"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.invoiceNumber,callback:function(t){e.$set(e.form,"invoiceNumber",t)},expression:"form.invoiceNumber"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"供应商/客户类型：",prop:"supplierType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierType,callback:function(t){e.$set(e.form,"supplierType",t)},expression:"form.supplierType"}},[i("el-option",{attrs:{label:"供应商",value:"供应商"}}),e._v(" "),i("el-option",{attrs:{label:"客户",value:"客户"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"440px"}},[i("el-col",{attrs:{span:19}},[i("el-form-item",{attrs:{label:"供应商/客户名称：",prop:"supplierName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierName,callback:function(t){e.$set(e.form,"supplierName",t)},expression:"form.supplierName"}},e._l(e.list,function(e){return i("el-option",{key:e.company_supplier_name,attrs:{label:e.company_supplier_name,value:e.company_supplier_name}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:3,offset:1}},[i("el-button",{attrs:{type:"",icon:"el-icon-plus"},on:{click:function(t){e.show_huoban=!0}}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"金额：",prop:"money"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.money,callback:function(t){e.$set(e.form,"money",t)},expression:"form.money"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"税率：",prop:"taxRate"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.taxRate,callback:function(t){e.$set(e.form,"taxRate",t)},expression:"form.taxRate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"价税合计：",prop:"priceTaxTotal"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.priceTaxTotal,callback:function(t){e.$set(e.form,"priceTaxTotal",t)},expression:"form.priceTaxTotal"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"元","label-width":"30px"}})],1)])]),e._v(" "),i("div",{staticStyle:{margin:"3vh"}},[e.form.invoicePhoto?i("img",{staticClass:"avatar",attrs:{src:e.form.invoicePhoto}}):e._e()]),e._v(" "),i("div",{staticStyle:{"border-bottom":"1px solid rgba(96,105,114,0.3)"}}),e._v(" "),i("div",{staticStyle:{"margin-top":"3vh"}},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submitForm("form")}}},[e._v("保存")]),e._v(" "),i("el-button",{attrs:{type:"info"},on:{click:function(t){return e.$router.push({path:"/home/fapiao/fapiaoguanli"})}}},[e._v("取消")])],1)],1)]),e._v(" "),e.show_huoban?i("addHuoBan",{on:{add_huoban_ok:e.add_huoban_ok}}):e._e()],1)},staticRenderFns:[]};var f=i("C7Lr")(d,v,!1,function(e){i("jLGC")},null,null);t.default=f.exports}});
//# sourceMappingURL=18.e10d5dcfaf57872d2598.js.map