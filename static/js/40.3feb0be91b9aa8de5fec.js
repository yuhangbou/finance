webpackJsonp([40],{IfJv:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("4YfN"),o=i.n(a),n=i("3cXf"),r=i.n(n),u=i("a3Yh"),s=i.n(u),l=i("IfhF"),c=i("7yAV"),p=i.n(c),m=i("ZZch"),f={name:"xianjinliuliangbiao",mixins:[l.a],data:function(){var e;return{show_huoban:!1,invoicePhoto1:"",list:[],form:{invoiceType:"",invoicingDate:"",authenticationDate:"",invoiceNumber:"",supplierType:"",supplierName:"",money:"",taxRate:"",priceTaxTotal:"",invoicePhoto:""},rules:(e={invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoicingDate:[{required:!0,message:"请选择开票日期",trigger:"change"}],invoiceNumber:[{required:!0,message:"请输入发票号码",trigger:"blur"}],supplierType:[{required:!0,message:"请选择供应商或客户",trigger:"change"}],supplierName:[{required:!0,message:"请选择",trigger:"change"}]},s()(e,"supplierType",[{required:!0,message:"请选择供应商或客户",trigger:"change"}]),s()(e,"money",[{required:!0,message:"请输入金额",trigger:"blur"}]),s()(e,"taxRate",[{required:!0,message:"请输入税率",trigger:"blur"}]),s()(e,"priceTaxTotal",[{required:!0,message:"请选择价税合计",trigger:"blur"}]),e)}},components:{addHuoBan:m.a},mounted:function(){var e=this;this.getStorage(),this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(t){e.list=t,"fapiaoguanli"!=e.$route.query.from||e.$route.query.no_show_storage||sessionStorage.getItem("tianjiafapiao_data")&&(e.form=JSON.parse(sessionStorage.getItem("tianjiafapiao_data"))),"fapiaoguanli"==e.$route.query.from&&e.$route.query.no_show_storage&&sessionStorage.getItem("tianjiafapiao_data")&&sessionStorage.removeItem("tianjiafapiao_data")})},methods:{add_huoban_ok:function(e){var t=this;1==e?this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(e){t.list=e,t.show_huoban=!1}):this.show_huoban=!1},add_huoban:function(){this.show_huoban=!0},submitForm_pingzheng:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;"pingzhengguanli_xiugai"==t.$route.query.from&&(sessionStorage.setItem("fapiao",r()(t.form)),sessionStorage.setItem("type1","shangchuan_fapiao"),t.$router.push({path:"/home/pingzhengguanli/editor_pingzheng",query:{certificateUuid:t.$route.query.certificateUuid}})),"pingzhengguanli"==t.$route.query.from&&t._ajax("userAccounts/addCertificateInvoice",o()({uuid:t.uuid,workAccountId:t.accountId,type1:1},t.form,{certificateUuid:t.$route.query.certificateUuid}),function(e){t._message(1,"保存成功"),t.$router.push({path:"/home/pingzhengguanli/pingzhengguanli"})}),"pingzhengguanli_tianjiapingzheng"==t.$route.query.from&&(sessionStorage.setItem("fapiao",r()(t.form)),sessionStorage.setItem("type1","shangchuan_fapiao"),t.$router.push("/home/pingzhengguanli/add_pingzheng")),"jizhang_add"==t.$route.query.type&&(localStorage.setItem("fapiao",r()(t.form)),localStorage.setItem("type1",0))})},cancel_pingzheng:function(){"pingzhengguanli_tianjiapingzheng"==this.$route.query.from&&this.$router.push("/home/pingzhengguanli/add_pingzheng"),"pingzhengguanli"==this.$route.query.from&&this.$router.push("/home/pingzhengguanli/pingzhengguanli"),"pingzhengguanli_xiugai"==this.$route.query.from&&this.$router.push({path:"/home/pingzhengguanli/editor_pingzheng",query:{certificateUuid:this.$route.query.certificateUuid}})},submitForm_fapiaoguanli:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;t._ajax("userAccounts/addUserInvoice",o()({uuid:t.uuid,workAccountId:t.accountId},t.form),function(e){t._message(1,"仅保存成功"),t.$router.push({path:"/home/fapiao/fapiaoguanli"})})})},tianjiapingzheng:function(e,t){var i=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;0==t?(sessionStorage.setItem("tianjiafapiao_data",r()(i.form)),i.$router.push({path:"/home/fapiao/tianjiapingzheng",query:{checked:"false"}})):(sessionStorage.setItem("tianjiafapiao_data",r()(i.form)),i.$router.push({path:"/home/fapiao/tianjiapingzheng",query:{checked:"true"}}))})},pipeixianyoupingzheng:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;sessionStorage.setItem("tianjiafapiao_data",r()(t.form)),t.$router.push({path:"/home/fapiao/pipeixianyoupingzheng",query:{from:"tianjiafapiao"}})})},pipeixianyouliushui:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;sessionStorage.setItem("tianjiafapiao_data",r()(t.form)),t.$router.push({path:"/home/fapiao/pipeixianyouliushui",query:{from:"tianjiafapiao"}})})},submitForm_liushui:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;"liushuiguanli"==t.$route.query.from&&t._ajax("userAccounts/addFlowingWaterInvoice",o()({uuid:t.uuid,workAccountId:t.accountId,type1:2,accountingId:t.$route.query.accountingId},t.form),function(e){t._message(1,"保存成功"),t.$router.go(-1)})})},change:function(e){var t=this,i=this.$message({type:"warning",message:"发票识别中请稍后",duration:0});!function(e,t){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.readAsDataURL(e)}(e.raw,function(e){t._ajax("common/invoice",{encode:r()(e.split(",")[1])},function(e){i.close(),t._message(1,"识别成功"),t.form.invoicePhoto=t.invoicePhoto1,t.form.invoiceId=e.kind,t.form.invoiceNumber=e.number,t.form.priceTaxTotal=e.total,t.form.money=e.pretax_amount,t.form.a=e.tax,t.form.taxRate=100*(e.tax/e.pretax_amount).toFixed(2)+"%";var a="";e.date.split("").forEach(function(t,i){"年"==t||"月"==t||"日"==t?i!=e.date.split("").length-1&&(a+="-"):a+=t}),t.form.invoicingDate=a})});var a=this;if(void 0==e)return!1;var o=e.name,n=o.substr(o.lastIndexOf(".")),u="user-herder"+Date.parse(new Date)/1e3+n;console.log(e),console.log(u),new p.a.Wrapper(this.$ali).multipartUpload(u,e.raw).then(function(e){console.log(e.res.requestUrls[0]),a.invoicePhoto1=e.res.requestUrls[0].split("?")[0]}).catch(function(e){console.log(e),a.$message({message:"服务器繁忙，请稍后再试",type:"error"})})}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{},[i("div",{staticStyle:{background:"#FFF",padding:"2vh 2vw","margin-bottom":"10vh"}},[i("div",{staticStyle:{"font-size":"30px",color:"#1C2023","text-align":"center"}},[e._v("添加发票")]),e._v(" "),i("div",{staticStyle:{border:"1px solid #F8F8FF",padding:"2vw","margin-top":"2vh"}},[i("el-upload",{attrs:{"on-change":e.change,action:"","show-file-list":!1,"auto-upload":!1}},[i("el-button",{attrs:{type:"warning"}},[e._v("点击上传")])],1),e._v(" "),i("div",{staticStyle:{"border-bottom":"1px solid rgba(96,105,114,0.3)",margin:"3vh 0"}}),e._v(" "),i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[i("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},[i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票类型：",prop:"invoiceType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[i("el-option",{attrs:{label:"专票",value:"0"}}),e._v(" "),i("el-option",{attrs:{label:"普票",value:"1"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"开票日期：",prop:"invoicingDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.invoicingDate,callback:function(t){e.$set(e.form,"invoicingDate",t)},expression:"form.invoicingDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"认证日期："}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.authenticationDate,callback:function(t){e.$set(e.form,"authenticationDate",t)},expression:"form.authenticationDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票号码：",prop:"invoiceNumber"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.invoiceNumber,callback:function(t){e.$set(e.form,"invoiceNumber",t)},expression:"form.invoiceNumber"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"100%",display:"flex","flex-wrap":"wrap"}},[i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"供应商/客户类型：",prop:"supplierType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierType,callback:function(t){e.$set(e.form,"supplierType",t)},expression:"form.supplierType"}},[i("el-option",{attrs:{label:"供应商",value:"供应商"}}),e._v(" "),i("el-option",{attrs:{label:"客户",value:"客户"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"440px"}},[i("el-col",{attrs:{span:19}},[i("el-form-item",{attrs:{label:"供应商/客户名称：",prop:"supplierName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierName,callback:function(t){e.$set(e.form,"supplierName",t)},expression:"form.supplierName"}},e._l(e.list,function(e){return i("el-option",{key:e.company_supplier_name,attrs:{label:e.company_supplier_name,value:e.company_supplier_name}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:3,offset:1}},[i("el-button",{attrs:{type:"",icon:"el-icon-plus"},on:{click:e.add_huoban}})],1)],1)]),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"金额：",prop:"money"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.money,callback:function(t){e.$set(e.form,"money",t)},expression:"form.money"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"税率：",prop:"taxRate"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.taxRate,callback:function(t){e.$set(e.form,"taxRate",t)},expression:"form.taxRate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"价税合计：",prop:"priceTaxTotal"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.priceTaxTotal,callback:function(t){e.$set(e.form,"priceTaxTotal",t)},expression:"form.priceTaxTotal"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"元","label-width":"30px"}})],1)])]),e._v(" "),i("div",{staticStyle:{"border-bottom":"1px solid rgba(96,105,114,0.3)"}}),e._v(" "),i("div",{staticStyle:{margin:"3vh"}},[i("img",{staticStyle:{width:"300px"},attrs:{src:e.form.invoicePhoto}})]),e._v(" "),"pingzhengguanli"==e.$route.query.from.split("_")[0]?i("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"5vh"}},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submitForm_pingzheng("form")}}},[e._v("保存")]),e._v(" "),i("el-button",{staticStyle:{"margin-left":"5vw"},attrs:{type:"info"},on:{click:e.cancel_pingzheng}},[e._v("返回")])],1):e._e(),e._v(" "),"liushuiguanli"==e.$route.query.from.split("_")[0]?i("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"5vh"}},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submitForm_liushui("form")}}},[e._v("保存")]),e._v(" "),i("el-button",{staticStyle:{"margin-left":"5vw"},attrs:{type:"info"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")])],1):e._e(),e._v(" "),"fapiaoguanli"==e.$route.query.from.split("_")[0]?i("div",{},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.tianjiapingzheng("form",0)}}},[e._v("生成凭证")]),e._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.tianjiapingzheng("form",1)}}},[e._v("生成凭证和流水")]),e._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.pipeixianyoupingzheng("form")}}},[e._v("匹配至现有凭证")]),e._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.pipeixianyouliushui("form")}}},[e._v("匹配至现有流水")])],1):e._e(),e._v(" "),"fapiaoguanli"==e.$route.query.from.split("_")[0]?i("div",{staticStyle:{"margin-top":"3vh"}},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.submitForm_fapiaoguanli("form")}}},[e._v("仅保存")]),e._v(" "),i("el-button",{attrs:{type:"info"},on:{click:function(t){return e.$router.push({path:"/home/fapiao/fapiaoguanli"})}}},[e._v("取消")])],1):e._e()],1),e._v(" "),e.show_huoban?i("addHuoBan",{on:{add_huoban_ok:e.add_huoban_ok}}):e._e()],1)])},staticRenderFns:[]};var h=i("C7Lr")(f,g,!1,function(e){i("i5/x")},null,null);t.default=h.exports},"i5/x":function(e,t){}});
//# sourceMappingURL=40.3feb0be91b9aa8de5fec.js.map