webpackJsonp([5],{"3Pj2":function(e,t){},H0zT:function(e,t){},KCWO:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("3cXf"),o=i.n(a),n=i("4YfN"),r=i.n(n),s=i("IfhF"),c=i("nqNp"),l=i("Zaux"),u={name:"xianjinliuliangbiao",mixins:[s.a],components:{addFaPiao:l.a,pingzheng:c.a},data:function(){return{guding_form:"",fapiaozujian_kaiguan:!1,yaoxinxi:!1,fanxian:"",flag1:"",flag2:"",form:{code:"",date:""},user:{tableData:[]},dialogVisible:!1,tableData1:[],id:"",page:1,pageSize:10,total:0}},mounted:function(){var e=this;this.getStorage(),this._ajax("userAccounts/selectCertificateUuid",{uuid:this.uuid,workAccountId:this.accountId,certificateUuid:this.$route.query.certificateUuid},function(t){e.flag1=t[0].flag1,e.flag2=t[0].flag2,e.form.code=t[0].certificate_number,e.form.date=t[0].creationTime;var i=[];t.forEach(function(e,t){var a={zhaiyao:e.certificate_abstract,jie:"",dai:"",index:t,jie_show:!1,dai_show:!1};e.accountant_subject.includes("-")?a.name=e.accountant_subject.split("-")[1]+","+e.accountant_code:a.name=e.accountant_subject+","+e.accountant_code,0==e.total_credit_money&&(a.dai_show=!0,a.jie=e.total_debit_money),0==e.total_debit_money&&(a.jie_show=!0,a.dai=e.total_credit_money),i.push(a)}),e.index=t.length-1,e.user.tableData=i,e.fanxian=i})},methods:{geiguding:function(e){this.guding_form=this.$store.state.gdzc,this.tiqu_ok_guding()},tiqu_ok_guding:function(){var e=this,t="",i="",a="",o="",n="";this.user.tableData.forEach(function(e){t+=e.zhaiyao+",",""==e.jie?i+="0,":i+=e.jie+",",""==e.dai?a+="0,":a+=e.dai+",",o+=e.name.split(",")[0]+",",n+=e.name.split(",")[1]+","}),"shangchuan_fapiao"==sessionStorage.getItem("type1")?this._ajax("userAccounts/addCertificateInvoice",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t},JSON.parse(sessionStorage.getItem("fapiao")),{flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,type1:1,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.clear(),e.$router.push("/home/pingzhengguanli/pingzhengguanli")}):sessionStorage.getItem("type1")?"pipei_fapiao"==sessionStorage.getItem("type1")&&(this._ajax("userAccounts/updateCertificate",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t,flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.$router.push("/home/pingzhengguanli/pingzhengguanli"),e.clear()}),this._ajax("userAccounts/updateAccountFlag",{uuid:this.uuid,workAccountId:this.accountId,certificateUuid:this.$route.query.uuid,invoiceId:this.id},function(t){e.clear()})):this._ajax("userAccounts/updateCertificate",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t,flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.$router.push("/home/pingzhengguanli/pingzhengguanli"),e.clear()})},ok:function(){isNaN(Number(this.form.code))||Number(this.form.code)<=0?this._message(2,"凭证字号格式不正确"):this.yaoxinxi=(new Date).getTime()},cancel:function(){this.clear(),this.$router.go(-1)},geixinxi:function(e,t){"guding"!=t&&(this.user=e,this.tiqu_ok())},tiqu_ok:function(){var e=this,t="",i="",a="",o="",n="";this.user.tableData.forEach(function(e){t+=e.zhaiyao+",",""==e.jie?i+="0,":i+=e.jie+",",""==e.dai?a+="0,":a+=e.dai+",",o+=e.name.split(",")[0]+",",n+=e.name.split(",")[1]+","}),"shangchuan_fapiao"==sessionStorage.getItem("type1")?this._ajax("userAccounts/addCertificateInvoice",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t},JSON.parse(sessionStorage.getItem("fapiao")),{flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,type1:1,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.clear(),e.$router.push("/home/pingzhengguanli/pingzhengguanli")}):sessionStorage.getItem("type1")?"pipei_fapiao"==sessionStorage.getItem("type1")&&(this._ajax("userAccounts/updateCertificate",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t,flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.$router.push("/home/pingzhengguanli/pingzhengguanli"),e.clear()}),this._ajax("userAccounts/updateAccountFlag",{uuid:this.uuid,workAccountId:this.accountId,certificateUuid:this.$route.query.uuid,invoiceId:this.id},function(t){e.clear()})):this._ajax("userAccounts/updateCertificate",r()({uuid:this.uuid,workAccountId:this.accountId,debitMoney:i,creditMoney:a,subject:o,code:n,certificateAbstract:t,flag1:this.flag1,flag2:this.flag2,certificateNumber:this.form.code,time:this.form.date,certificateUuid:this.$route.query.certificateUuid},this.guding_form,{type2:1}),function(t){e._message(1,"修改成功"),e.$router.push("/home/pingzhengguanli/pingzhengguanli"),e.clear()})},clear:function(){sessionStorage.removeItem("type1"),sessionStorage.removeItem("fapiao")},pingzhengzihao:function(){var e=this;this._ajax("userHomePage/selectCertificateNumber",{uuid:this.uuid,workAccountId:this.accountId,time:this.form.date},function(t){e.form.code=t.number})},congxianyoupiaojuxuanze:function(){this.list_bind()},list_bind:function(){var e=this;this._ajax("userAccounts/selectNoInvoice",{uuid:this.uuid,workAccountId:this.accountId,page:this.page,pageSize:this.pageSize},function(t){e.tableData1=t.PageInfo.list,e.total=t.PageInfo.total,e.dialogVisible=!0})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.list_bind()},handleCurrentChange:function(e){console.log("当前页: "+e),this.dangqianye=e,this.list_bind()},dialogVisible_ok:function(){0!=this.id?(sessionStorage.setItem("fapiao",o()(this.id)),sessionStorage.setItem("type1","pipei_fapiao"),this.dialogVisible=!1):this._message(2,"请选择一个")}}},d={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticStyle:{background:"#FFF",padding:"2vh 2vw"}},[i("div",{staticStyle:{"font-size":"30px",color:"#1C2023","text-align":"center"}},[e._v("修改凭证")]),e._v(" "),i("div",{staticStyle:{border:"1px solid #F8F8FF",padding:"2vw","margin-top":"2vh"}},[i("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"flex-start"}},[i("div",[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.form}},[i("el-form-item",{attrs:{label:"凭证字号："}},[i("el-input",{attrs:{placeholder:""},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"号"}}),e._v(" "),i("el-form-item",{attrs:{label:"日期："}},[i("el-date-picker",{attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},on:{change:e.pingzhengzihao},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)],1)],1),e._v(" "),i("div",[i("el-button",{attrs:{type:"warning"},on:{click:function(t){e.fapiaozujian_kaiguan=!0}}},[e._v("上传票据")]),e._v(" "),i("el-button",{attrs:{type:"warning"},on:{click:e.congxianyoupiaojuxuanze}},[e._v("从现有票据选择")])],1)]),e._v(" "),i("pingzheng",{attrs:{yaoxinxi:e.yaoxinxi,fanxian:e.fanxian,type:"editor_pingzheng"},on:{geixinxi:e.geixinxi,geiguding:e.geiguding}}),e._v(" "),i("div",{staticStyle:{display:"flex","justify-content":"center","margin-top":"5vh"}},[i("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.ok()}}},[e._v("保存")]),e._v(" "),i("el-button",{staticStyle:{"margin-left":"5vw"},attrs:{type:"info"},on:{click:e.cancel}},[e._v("返回")])],1)],1)]),e._v(" "),i("el-dialog",{attrs:{title:"",visible:e.dialogVisible,"close-on-press-escape":!1,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-table",{attrs:{data:e.tableData1}},[i("el-table-column",{attrs:{prop:"",label:"单选",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-radio",{attrs:{label:t.row.id},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}},[e._v(" ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"creation_time",label:"上传时间",width:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"company_invoice_number",label:"发票号码",width:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"company_supplier_name",label:"供应商/客户名称",width:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"price_tax_total",label:"价税合计",width:""}})],1),e._v(" "),i("div",{staticStyle:{display:"flex","justify-content":"flex-end","margin-top":"1vh"}},[i("el-pagination",{attrs:{"current-page":e.page,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.dialogVisible_ok}},[e._v("确 定")])],1)],1),e._v(" "),e.fapiaozujian_kaiguan?i("addFaPiao",{on:{fapiaozujian:function(t){e.fapiaozujian_kaiguan=!1}}}):e._e()],1)},staticRenderFns:[]};var p=i("C7Lr")(u,d,!1,function(e){i("3Pj2")},null,null);t.default=p.exports},Zaux:function(e,t,i){"use strict";var a=i("3cXf"),o=i.n(a),n=i("a3Yh"),r=i.n(n),s=i("IfhF"),c=i("7yAV"),l=i.n(c),u=i("ZZch"),d={name:"add_yewuhuoban",mixins:[s.a],components:{addHuoBan:u.a},mounted:function(){var e=this;this.getStorage(),this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(t){e.list=t})},data:function(){var e;return{show_huoban:!1,dialogVisible:!0,invoicePhoto1:"",list:[],form:{invoiceType:"",invoicingDate:"",authenticationDate:"",invoiceNumber:"",supplierType:"",supplierName:"",money:"",taxRate:"",priceTaxTotal:"",invoicePhoto:""},rules:(e={invoiceType:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoicingDate:[{required:!0,message:"请选择开票日期",trigger:"change"}],invoiceNumber:[{required:!0,message:"请输入发票号码",trigger:"blur"}],supplierType:[{required:!0,message:"请选择供应商或客户",trigger:"change"}],supplierName:[{required:!0,message:"请选择",trigger:"change"}]},r()(e,"supplierType",[{required:!0,message:"请选择供应商或客户",trigger:"change"}]),r()(e,"money",[{required:!0,message:"请输入金额",trigger:"blur"}]),r()(e,"taxRate",[{required:!0,message:"请输入税率",trigger:"blur"}]),r()(e,"priceTaxTotal",[{required:!0,message:"请选择价税合计",trigger:"blur"}]),e)}},methods:{show_huoban_ok_cancel:function(e){var t=this;1==e?this._ajax("userAccounts/selectCompanySupplierName",{company_supplier_name:"",uuid:this.uuid,workAccountId:this.accountId},function(e){t.list=e,t.show_huoban=!1}):this.show_huoban=!1},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;sessionStorage.setItem("fapiao",o()(t.form)),sessionStorage.setItem("type1","shangchuan_fapiao"),t.$emit("fapiaozujian")})},change:function(e){var t=this,i=this.$message({type:"warning",message:"发票识别中请稍后",duration:0}),a=new FileReader;a.readAsDataURL(e.raw),a.onload=function(){t._ajax("common/invoice",{encode:o()(a.result.split(",")[1])},function(e){if(i.close(),"[object Object]"!=Object.prototype.toString.call(e)||!e.hasOwnProperty("state")){t._message(1,"识别成功"),t.form.invoicePhoto=t.invoicePhoto1,t.form.invoiceNumber=e.number,t.form.priceTaxTotal=e.total,t.form.money=e.pretax_amount,t.form.taxRate=100*(e.tax/e.pretax_amount).toFixed(2)+"%";var a="";e.date.split("").forEach(function(t,i){"年"==t||"月"==t||"日"==t?i!=e.date.split("").length-1&&(a+="-"):a+=t}),t.form.invoicingDate=a}})};var n=this;if(void 0==e)return!1;var r=e.name,s=r.substr(r.lastIndexOf(".")),c="user-herder"+Date.parse(new Date)/1e3+s;new l.a.Wrapper(this.$ali).multipartUpload(c,e.raw).then(function(e){n.invoicePhoto1=e.res.requestUrls[0].split("?")[0]}).catch(function(e){n.$message({message:"服务器繁忙，请稍后再试",type:"error"})})}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("el-dialog",{attrs:{"show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,title:"提示",visible:e.dialogVisible,width:"60%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("div",{staticStyle:{"margin-bottom":"30px"}},[i("el-upload",{attrs:{"on-change":e.change,action:"","show-file-list":!1,"auto-upload":!1}},[i("el-button",{attrs:{type:"warning"}},[e._v("点击上传")])],1)],1),e._v(" "),i("span",[i("el-form",{ref:"form",attrs:{model:e.form,"label-width":"145px",rules:e.rules}},[i("div",{staticStyle:{display:"flex","flex-wrap":"wrap"}},[i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票类型：",prop:"invoiceType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.invoiceType,callback:function(t){e.$set(e.form,"invoiceType",t)},expression:"form.invoiceType"}},[i("el-option",{attrs:{label:"专票",value:"0"}}),e._v(" "),i("el-option",{attrs:{label:"普票",value:"1"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"开票日期：",prop:"invoicingDate"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.invoicingDate,callback:function(t){e.$set(e.form,"invoicingDate",t)},expression:"form.invoicingDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"认证日期："}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"","value-format":"yyyy-MM-dd"},model:{value:e.form.authenticationDate,callback:function(t){e.$set(e.form,"authenticationDate",t)},expression:"form.authenticationDate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"发票号码：",prop:"invoiceNumber"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.invoiceNumber,callback:function(t){e.$set(e.form,"invoiceNumber",t)},expression:"form.invoiceNumber"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"供应商/客户类型：",prop:"supplierType"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierType,callback:function(t){e.$set(e.form,"supplierType",t)},expression:"form.supplierType"}},[i("el-option",{attrs:{label:"供应商",value:"供应商"}}),e._v(" "),i("el-option",{attrs:{label:"客户",value:"客户"}})],1)],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-col",{attrs:{span:19}},[i("el-form-item",{attrs:{label:"供应商/客户名称：",prop:"supplierName"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.form.supplierName,callback:function(t){e.$set(e.form,"supplierName",t)},expression:"form.supplierName"}},e._l(e.list,function(e){return i("el-option",{key:e.company_supplier_name,attrs:{label:e.company_supplier_name,value:e.company_supplier_name}})}),1)],1)],1),e._v(" "),i("el-col",{attrs:{span:3,offset:1}},[i("el-button",{attrs:{type:"",icon:"el-icon-plus"},on:{click:function(t){e.show_huoban=!0}}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"金额：",prop:"money"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.money,callback:function(t){e.$set(e.form,"money",t)},expression:"form.money"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-form-item",{attrs:{label:"税率：",prop:"taxRate"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.taxRate,callback:function(t){e.$set(e.form,"taxRate",t)},expression:"form.taxRate"}})],1)],1),e._v(" "),i("div",{staticStyle:{width:"350px"}},[i("el-col",{attrs:{span:21}},[i("el-form-item",{attrs:{label:"价税合计：",prop:"priceTaxTotal"}},[i("el-input",{staticStyle:{width:"100%"},model:{value:e.form.priceTaxTotal,callback:function(t){e.$set(e.form,"priceTaxTotal",t)},expression:"form.priceTaxTotal"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:3}},[i("el-form-item",{attrs:{label:"元","label-width":"100%"}})],1)],1)])])],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){return e.$emit("fapiaozujian")}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("form")}}},[e._v("确 定")])],1)]),e._v(" "),e.show_huoban?i("addHuoBan",{on:{add_huoban_ok:e.show_huoban_ok_cancel}}):e._e()],1)},staticRenderFns:[]};var f=i("C7Lr")(d,p,!1,function(e){i("H0zT")},"data-v-23e3ecc8",null);t.a=f.exports}});
//# sourceMappingURL=5.dc9ea9d8042723ce9bd6.js.map